---
// Componente de formulario para solicitudes de trabajo
---

<div class="max-w-2xl mx-auto">
  <form id="trabaja-form" class="space-y-6">
    <!-- Nombre -->
    <div>
      <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">
        Nombre Completo *
      </label>
      <input
        type="text"
        id="nombre"
        name="nombre"
        required
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-[#D4AF37] transition-all duration-200"
        placeholder="Tu nombre completo"
      />
    </div>

    <!-- Email -->
    <div>
      <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
        Email *
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-[#D4AF37] transition-all duration-200"
        placeholder="tu@email.com"
      />
    </div>

    <!-- Tel√©fono -->
    <div>
      <label for="telefono" class="block text-sm font-medium text-gray-700 mb-2">
        Tel√©fono *
      </label>
      <input
        type="tel"
        id="telefono"
        name="telefono"
        required
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-[#D4AF37] transition-all duration-200"
        placeholder="+569 1234 5678"
      />
    </div>

    <!-- Mensaje -->
    <div>
      <label for="mensaje" class="block text-sm font-medium text-gray-700 mb-2">
        Carta de Presentaci√≥n
      </label>
      <textarea
        id="mensaje"
        name="mensaje"
        rows="6"
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-[#D4AF37] transition-all duration-200 resize-none"
        placeholder="Cu√©ntanos por qu√© te gustar√≠a trabajar con nosotros..."
      ></textarea>
    </div>

    <!-- Upload CV PDF -->
    <div>
      <label for="cv" class="block text-sm font-medium text-gray-700 mb-2">
        Cargar CV (PDF) *
      </label>
      <div class="relative">
        <input
          type="file"
          id="cv"
          name="cv"
          accept=".pdf"
          required
          class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-[#D4AF37] transition-all duration-200 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-[#D4AF37] file:text-white hover:file:bg-[#B8941F] file:cursor-pointer"
        />
      </div>
      <p class="text-sm text-gray-500 mt-2">
        Solo se aceptan archivos PDF. M√°ximo 5MB.
      </p>
    </div>

    <!-- T√©rminos -->
    <div class="flex items-start">
      <input
        type="checkbox"
        id="terminos"
        name="terminos"
        required
        class="mt-1 w-4 h-4 border-2 border-gray-300 rounded cursor-pointer text-[#D4AF37] focus:ring-[#D4AF37]"
      />
      <label for="terminos" class="ml-3 text-sm text-gray-600">
        Acepto que mis datos sean procesados para la evaluaci√≥n de mi candidatura *
      </label>
    </div>

    <!-- Bot√≥n Submit -->
    <div class="pt-4">
      <button
        type="submit"
        class="w-full px-6 py-3 bg-gradient-to-r from-[#D4AF37] to-[#B8941F] text-white rounded-lg font-semibold hover:shadow-lg hover:scale-105 transition-all duration-300"
      >
        Enviar Candidatura
      </button>
    </div>

    <!-- Mensaje de estado -->
    <div id="form-status" style="display:none;" class="p-4 rounded-lg text-center font-medium"></div>
  </form>
</div>

<script is:inline>
  (() => {
    const form = document.getElementById('trabaja-form');
    const fileInput = document.getElementById('cv');
    const statusDiv = document.getElementById('form-status');

    if (!form || !statusDiv) return;

    const showStatus = (type, text) => {
      statusDiv.style.display = 'block';
      statusDiv.textContent = text;
      if (type === 'error') {
        statusDiv.className = 'p-4 rounded-lg text-center font-medium bg-red-50 text-red-700 border border-red-200';
      } else if (type === 'loading') {
        statusDiv.className = 'p-4 rounded-lg text-center font-medium bg-blue-50 text-blue-700 border border-blue-200';
      } else {
        statusDiv.className = 'p-4 rounded-lg text-center font-medium bg-green-50 text-green-700 border border-green-200';
      }
    };

    // Validar archivo
    fileInput?.addEventListener('change', function(e) {
      const file = e.target.files?.[0];
      if (!file) return;

      const maxSize = 5 * 1024 * 1024;
      if (file.size > maxSize) {
        showStatus('error', '‚ùå El archivo es demasiado grande. M√°ximo 5MB.');
        fileInput.value = '';
        return;
      }
      if (file.type !== 'application/pdf') {
        showStatus('error', '‚ùå Solo se aceptan archivos PDF.');
        fileInput.value = '';
        return;
      }
      statusDiv.style.display = 'none';
    });

    // Manejar env√≠o
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!fileInput?.files?.[0]) {
        showStatus('error', '‚ùå Por favor, selecciona un CV en PDF');
        return;
      }

      const formData = new FormData(form);

      showStatus('loading', 'üì§ Enviando tu candidatura...');

      try {
        const res = await fetch('/api/enviar-candidatura', {
          method: 'POST',
          body: formData
        });

        const data = await res.json();
        if (res.ok && data.success) {
          showStatus('success', '‚úÖ ¬°Gracias por tu candidatura! Nos pondremos en contacto pronto.');
          form.reset();
          // Limpiar el mensaje despu√©s de 5 segundos
          setTimeout(() => {
            statusDiv.style.display = 'none';
          }, 5000);
        } else {
          showStatus('error', `‚ùå ${data?.message || 'Error al enviar la candidatura'}`);
        }
      } catch (err) {
        // eslint-disable-next-line no-console
        console.error('Error enviando candidatura:', err);
        showStatus('error', '‚ùå Error del servidor. Intenta m√°s tarde.');
      }
    });
  })();
</script>
